<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PW Push</title><link rel=stylesheet href=style.css integrity=sha384-j8EMcs+cfT0m5PnhokvIPnYevLXBxC4V9S1+rWpgseCX4DBA62BCR6WszgUJ1Afq crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/site.webmanifest><div class=container><div id=header><h1>PW Push</h1><p class=subtitle id=page-subtitle>Client-Side Encryption (AES-GCM)</div><div id=generator-mode><div class=form-group><label for=secret-input>Secret Message</label> <textarea id=secret-input maxlength=100 placeholder="Enter sensitive data here"></textarea><div id=char-counter class=char-count>0/100</div></div><div class=form-group><label for=encrypt-pin>Encryption PIN / Passphrase</label> <input type=password id=encrypt-pin placeholder="Enter a strong PIN or Password" minlength=4 autocomplete=new-password><p class=small-note>Note: A longer passphrase is much more secure than a 4-digit PIN.</div><button id=btn-generate>Generate Secure Link</button><div id=gen-error class=error-msg></div><div id=result-area class=hidden><div class=link-container><input id=share-link readonly> <button id=btn-copy>Copy</button></div></div></div><div id=decrypt-mode class=hidden><div class=form-group><label>Status</label><div style=color:var(--text);margin-bottom:1rem>ðŸ”’ Encrypted payload detected</div></div><div class=form-group><label for=decrypt-pin>Enter PIN / Passphrase to Unlock</label> <input type=password id=decrypt-pin placeholder="Enter PIN" autocomplete=new-password></div><button id=btn-decrypt>Unlock Message</button><div id=decrypt-error class=error-msg></div><div id=decrypted-result class="hidden result-box"><label>Decrypted Message:</label><div id=secret-display style=margin-top:.5rem;font-family:monospace></div></div></div></div><script>const PBKDF2_ITERATIONS=6e5,SALT_LENGTH=16,IV_LENGTH=12,PAYLOAD_VERSION=1,getEl=e=>document.getElementById(e);function bufferToBase64(e){const t=new Uint8Array(e);let n="";for(let e=0;e<t.byteLength;e++)n+=String.fromCharCode(t[e]);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function base64ToBuffer(e){for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n.buffer}async function deriveKey(e,t){const n=new TextEncoder,r=await crypto.subtle.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:6e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function encryptData(e,t){const n=new TextEncoder,r=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),o=await deriveKey(t,r),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,n.encode(e)),i=new Uint8Array(1+r.byteLength+a.byteLength+c.byteLength);return i[0]=1,i.set(r,1),i.set(a,1+r.byteLength),i.set(new Uint8Array(c),1+r.byteLength+a.byteLength),bufferToBase64(i.buffer)}async function decryptData(e,t){try{const n=new Uint8Array(base64ToBuffer(e));if(1!==n[0])throw new Error("Unknown payload version");const r=n.slice(1,17),a=n.slice(17,29),o=n.slice(29),c=await deriveKey(t,r),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},c,o);return(new TextDecoder).decode(i)}catch(e){throw console.error(e),new Error("Decryption failed. Wrong PIN or corrupted data.")}}function initApp(){if(!window.crypto||!window.crypto.subtle){return void(getEl("gen-error").innerText="Web Crypto API not supported. Please use a modern browser.")}const e=window.location.hash.substring(1);new URLSearchParams(e).get("payload")?(getEl("generator-mode").classList.add("hidden"),getEl("decrypt-mode").classList.remove("hidden"),getEl("page-subtitle").innerText="Unlock secure message"):(getEl("decrypt-mode").classList.add("hidden"),getEl("generator-mode").classList.remove("hidden"));const t=getEl("secret-input"),n=getEl("char-counter");t&&t.addEventListener("input",()=>{n.innerText=`${t.value.length}/100`});const r=getEl("btn-generate");r&&r.addEventListener("click",generateSecureLink);const a=getEl("share-link");a&&a.addEventListener("click",function(){this.select()});const o=getEl("btn-copy");o&&o.addEventListener("click",copyLink);const c=getEl("btn-decrypt");c&&c.addEventListener("click",decryptPayload);const i=getEl("link-reset");i&&i.addEventListener("click",e=>{e.preventDefault(),window.location.hash="",window.location.reload()})}async function generateSecureLink(){const e=getEl("secret-input").value,t=getEl("encrypt-pin").value,n=getEl("gen-error");if(n.innerText="",e&&t)if(t.length<4)n.innerText="PIN must be at least 4 characters long. Ideally it should be longer than 8 characters.";else try{const n=await encryptData(e,t),r=`${window.location.origin+window.location.pathname}#payload=${n}`;getEl("share-link").value=r,getEl("result-area").classList.remove("hidden")}catch(e){n.innerText="Error generating crypto: "+e.message}else n.innerText="Please enter both a secret and a PIN."}async function decryptPayload(){const e=window.location.hash.substring(1),t=new URLSearchParams(e).get("payload"),n=getEl("decrypt-pin").value,r=getEl("decrypt-error"),a=getEl("decrypted-result"),o=getEl("secret-display");if(r.innerText="",a.classList.add("hidden"),n)try{const e=await decryptData(t,n);o.innerText=e,a.classList.remove("hidden")}catch(e){r.innerText="Incorrect PIN or invalid data."}else r.innerText="Please enter the PIN."}function copyLink(){getEl("share-link").select(),document.execCommand("copy");const e=document.querySelector(".link-container button"),t=e.innerText;e.innerText="Copied!",setTimeout(()=>e.innerText=t,1500)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initApp):initApp()</script>
